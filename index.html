<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>학급 청소당번 추첨기</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="bg-gradient-to-br from-blue-900 to-indigo-900 text-white min-h-screen flex items-center justify-center p-4">
  <div class="bg-white/10 backdrop-blur-md p-6 rounded-2xl shadow-lg w-full max-w-lg">
    <h1 class="text-3xl font-bold mb-2">학급 청소당번 추첨기</h1>
    <p class="text-gray-300 mb-4">1번부터 30번 사이에서 <strong>중복 없이</strong> 원하는 인원을 랜덤 추첨합니다.</p>

    <div class="row g-3 mb-4">
      <div class="col-md-6">
        <label class="form-label">시작 번호</label>
        <input type="number" id="min" class="form-control" value="1" min="1">
      </div>
      <div class="col-md-6">
        <label class="form-label">끝 번호</label>
        <input type="number" id="max" class="form-control" value="30" min="1">
      </div>
      <div class="col-md-6">
        <label class="form-label">뽑을 인원 수</label>
        <input type="number" id="count" class="form-control" value="5" min="1">
      </div>
      <div class="col-md-6">
        <label class="form-label">제외할 번호</label>
        <input type="text" id="exclude" class="form-control" placeholder="예: 3, 7, 11">
      </div>
    </div>

    <div class="d-flex gap-2 mb-4">
      <button id="draw" class="btn btn-primary flex-1">🎲 추첨하기</button>
      <button id="reshuffle" class="btn btn-secondary flex-1">🔁 다시 추첨</button>
    </div>

    <div id="result" class="flex flex-wrap gap-2"></div>
  </div>

  <script>
    const $ = id => document.getElementById(id);
    let lastPool = [];

    function parseExclude(str){
      if(!str.trim()) return new Set();
      return new Set(str.split(/[^\d]+/).map(s=>s.trim()).filter(Boolean).map(Number));
    }

    function makePool(min, max, exclude){
      const pool = [];
      for(let n=min; n<=max; n++) if(!exclude.has(n)) pool.push(n);
      return pool;
    }

    function shuffle(arr){
      for(let i=arr.length-1; i>0; i--){
        const j = Math.floor(Math.random()*(i+1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function drawOnce(){
      const min = parseInt($("min").value);
      const max = parseInt($("max").value);
      const count = parseInt($("count").value);
      const exclude = parseExclude($("exclude").value);

      if(min>max){
        Swal.fire('오류','시작 번호가 끝 번호보다 큽니다.','error');
        return;
      }
      if(count<1){
        Swal.fire('오류','뽑을 인원 수는 1 이상이어야 합니다.','error');
        return;
      }
      const pool = makePool(min, max, exclude);
      if(count>pool.length){
        Swal.fire('오류',`뽑을 인원 수(${count})가 가능한 인원 수(${pool.length})보다 많습니다.`,'error');
        return;
      }

      lastPool = [...pool];
      shuffle(pool);
      const picked = pool.slice(0,count).sort((a,b)=>a-b);
      displayResult(picked);
      Swal.fire('추첨 완료',`추첨된 번호: ${picked.join(', ')}`,'success');
    }

    function reshuffle(){
      if(!lastPool.length){
        drawOnce();
        return;
      }
      const count = parseInt($("count").value);
      const pool = [...lastPool];
      shuffle(pool);
      const picked = pool.slice(0,count).sort((a,b)=>a-b);
      displayResult(picked);
      Swal.fire('다시 추첨 완료',`새 번호: ${picked.join(', ')}`,'success');
    }

    function displayResult(numbers){
      const result = $("result");
      result.innerHTML = '';
      numbers.forEach(num => {
        const div = document.createElement('div');
        div.className = 'px-4 py-2 bg-indigo-600 rounded-full font-bold text-lg shadow-md';
        div.textContent = num;
        result.appendChild(div);
      });
    }

    $("draw").addEventListener('click', drawOnce);
    $("reshuffle").addEventListener('click', reshuffle);
  </script>
</body>
</html>
