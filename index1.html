<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>í•™ìƒ ìë¦¬ë°°ì¹˜ í”„ë¡œê·¸ë¨</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    /* ì•½ê°„ì˜ ë””í…Œì¼ */
    body{
      min-height:100vh;
      background: radial-gradient(1200px 800px at 80% -10%, #1f2937 0%, #0f172a 60%);
      color:#e5e7eb;
    }
    .glass {
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border: 1px solid rgba(255,255,255,.12);
      backdrop-filter: blur(8px);
    }
    .seat-card {
      transition: transform .08s ease, box-shadow .2s ease;
    }
    .seat-card:hover { transform: translateY(-2px); }
    .seat-empty { opacity:.6; }
    .badge-kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      border:1px solid rgba(255,255,255,.18);
      border-radius:6px;
      padding:2px 6px;
      font-size:12px;
    }
  </style>
</head>
<body class="d-flex align-items-center justify-content-center p-4">

  <main class="container">
    <div class="glass rounded-4 shadow-lg p-4 p-md-5 mx-auto" style="max-width: 1080px;">
      <div class="d-flex flex-wrap align-items-end justify-content-between gap-2 mb-3">
        <div>
          <h1 class="h3 fw-bold mb-1">í•™ìƒ ìë¦¬ë°°ì¹˜ í”„ë¡œê·¸ë¨</h1>
          <p class="text-secondary mb-0">ì´ë¦„ì„ ì…ë ¥í•˜ê³ , í–‰Â·ì—´ì„ ì§€ì •í•œ ë’¤ <b>ëœë¤ ë°°ì¹˜</b>í•˜ì„¸ìš”.</p>
        </div>
        <div class="text-secondary">
          ë‹¨ì¶•í‚¤: <span class="badge-kbd">Enter</span>=ë°°ì¹˜, <span class="badge-kbd">R</span>=ì¬ë°°ì¹˜
        </div>
      </div>

      <!-- ì„¤ì • -->
      <div class="row g-3">
        <div class="col-12 col-lg-6">
          <label for="names" class="form-label">í•™ìƒ ì´ë¦„ ëª©ë¡ <small class="text-secondary">(ì¤„ë°”ê¿ˆìœ¼ë¡œ êµ¬ë¶„)</small></label>
          <textarea id="names" class="form-control" rows="8" placeholder="ì˜ˆ)&#10;í™ê¸¸ë™&#10;ê¹€ì² ìˆ˜&#10;ì´ì˜í¬"></textarea>
          <div class="form-text">ì´ë¦„ì„ í•œ ì¤„ì— í•œ ëª…ì”© ì…ë ¥í•˜ì„¸ìš”.</div>
        </div>

        <div class="col-12 col-lg-6">
          <div class="row g-3">
            <div class="col-6">
              <label for="rows" class="form-label">í–‰(Row)</label>
              <input id="rows" type="number" class="form-control" min="1" value="5">
            </div>
            <div class="col-6">
              <label for="cols" class="form-label">ì—´(Col)</label>
              <input id="cols" type="number" class="form-control" min="1" value="6">
            </div>

            <div class="col-12 d-flex gap-2">
              <button id="btnFill" class="btn btn-secondary flex-fill">ğŸ“ ëœë¤ ì´ë¦„ ì±„ìš°ê¸°</button>
              <button id="btnAssign" class="btn btn-primary flex-fill">ğŸ² ìë¦¬ ë°°ì¹˜</button>
            </div>

            <div class="col-12 d-flex gap-2">
              <button id="btnReshuffle" class="btn btn-outline-light flex-fill">ğŸ” ê°™ì€ ëª…ë‹¨ ì¬ë°°ì¹˜</button>
              <button id="btnClear" class="btn btn-outline-danger flex-fill">ğŸ§¹ ì´ˆê¸°í™”</button>
            </div>

            <div class="col-12">
              <div id="stats" class="text-secondary small"></div>
            </div>
          </div>
        </div>
      </div>

      <hr class="border-secondary-subtle my-4">

      <!-- ì¢Œì„ ë°°ì¹˜ ì¶œë ¥ -->
      <div id="seatWrap" class="w-100">
        <div id="seats" class="grid gap-3"></div>
      </div>
    </div>
  </main>

  <script>
    // --- ìš”ì†Œ ì°¸ì¡° ---
    const $ = (id) => document.getElementById(id);
    const namesEl = $("names");
    const rowsEl  = $("rows");
    const colsEl  = $("cols");
    const seatsEl = $("seats");
    const statsEl = $("stats");
    const btnFill = $("btnFill");
    const btnAssign = $("btnAssign");
    const btnReshuffle = $("btnReshuffle");
    const btnClear = $("btnClear");

    // --- ìƒ˜í”Œ ì´ë¦„ í’€ (50+ëª…) ---
    const sampleNames = [
      "ê¹€ê°€ì€","ê¹€ë„ìœ¤","ê¹€ë¯¼ì¤€","ê¹€ì„œì¤€","ê¹€ì„œì—°","ê¹€ì„œìœ¤","ê¹€ì‹œìš°","ê¹€ì˜ˆë¦°","ê¹€ìœ ì¤€","ê¹€ì§€ìš°",
      "ë°•ê±´ìš°","ë°•ë„ìœ¤","ë°•ë¯¼ì„œ","ë°•ì„œìœ¨","ë°•ì„œì—°","ë°•ì§€í›„","ë°•í•˜ë¦°","ë°•í•˜ìœ¤","ë°•í˜„ìš°","ë°•í˜œì¸",
      "ì„œë‹¤ì¸","ì„œë¯¼ì¬","ì„œì†Œìœ¨","ì„œìš°ì§„","ì„œì±„ì›","ì„œí•˜ì¤€","ì„œí˜„ìš°","ì„œí¬ì›","ì„±ì§€í›„","ì†Œì§€ìœ ",
      "ì•ˆë„í˜„","ì•ˆë¯¼ê·œ","ì•ˆì„œì§„","ì•ˆì˜ˆì§„","ì–‘ì§€ìœ¤","ì˜¤ê°€ì˜¨","ì˜¤ë‹¤ì€","ì˜¤ì„œì•„","ì˜¤ì˜ˆì¤€","ì˜¤ì§€ì•ˆ",
      "ìœ ë‚˜ìœ¤","ìœ ë„í˜„","ìœ ë¦¬í•˜","ìœ ì„œí•˜","ìœ ì§€í˜¸","ìœ¤ê°€ì˜¨","ìœ¤ë„ìœ¤","ìœ¤ì„œí˜„","ìœ¤ì˜ˆì§„","ìœ¤ì§€í›„",
      "ì´ê±´í¬","ì´ë„í˜„","ì´ë¯¼ì¬","ì´ì„œìœ¤","ì´ìŠ¹ìš°","ì´ì‹œìœ¤","ì´ì˜ˆë‚˜","ì´ì •ìš°","ì´ì§€í›„","ì´í•˜ë¦°",
      "ì„ë‚˜ì˜ˆ","ì„ë‹¤ì˜¨","ì„ë¼ì˜¨","ì„ì„œìš°","ì„ì§€ì•ˆ","ì¥ë¯¼ì„œ","ì¥ì„œì—°","ì¥ìˆ˜ì•„","ì „ë„ìœ¨","ì „ìš°ì£¼",
      "ì •ê°€ì€","ì •ë„ìœ¤","ì •ë¯¼ì¤€","ì •ì„œìš°","ì •ì‹œìœ¤","ì •ì˜ˆì¤€","ì •ì´ë“ ","ì •ì£¼í•˜","ì¡°ë‚˜ìœ¨","ì¡°ë¯¼í•˜"
    ];

    // --- ìœ í‹¸ ---
    function shuffle(arr){
      for(let i=arr.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [arr[i],arr[j]] = [arr[j],arr[i]];
      }
      return arr;
    }
    const unique = (arr) => [...new Set(arr)];

    function parseNames(text){
      return text
        .split(/\n+/)
        .map(s => s.trim())
        .filter(Boolean);
    }

    function capacity(){
      const r = parseInt(rowsEl.value,10) || 0;
      const c = parseInt(colsEl.value,10) || 0;
      return Math.max(0, r) * Math.max(0, c);
    }

    function saveState(){
      localStorage.setItem("seat_rows", rowsEl.value);
      localStorage.setItem("seat_cols", colsEl.value);
      localStorage.setItem("seat_names", namesEl.value);
    }

    function loadState(){
      const r = localStorage.getItem("seat_rows");
      const c = localStorage.getItem("seat_cols");
      const n = localStorage.getItem("seat_names");
      if(r) rowsEl.value = r;
      if(c) colsEl.value = c;
      if(n) namesEl.value = n;
    }

    // --- ì¢Œì„ ë Œë”ë§ ---
    function renderSeats(list, rows, cols){
      // Tailwind CSS grid í…œí”Œë¦¿ ë™ì  ì§€ì •
      seatsEl.style.display = "grid";
      seatsEl.style.gridTemplateColumns = `repeat(${cols}, minmax(0,1fr))`;

      seatsEl.innerHTML = "";
      const total = rows * cols;

      for(let i=0;i<total;i++){
        const name = list[i] ?? "";
        const card = document.createElement("div");
        card.className = `seat-card rounded-3 p-3 text-center shadow-sm glass ${name ? "" : "seat-empty"}`;

        const seatNo = document.createElement("div");
        seatNo.className = "small text-secondary mb-1";
        seatNo.textContent = `${i+1}ë²ˆ ìë¦¬`;

        const label = document.createElement("div");
        label.className = "fw-bold h5 mb-0";
        label.textContent = name || "ë¹ˆ ìë¦¬";

        card.appendChild(seatNo);
        card.appendChild(label);
        seatsEl.appendChild(card);
      }

      statsEl.textContent = `ì¢Œì„ ìˆ˜: ${total} â€¢ ë°°ì¹˜ëœ í•™ìƒ: ${list.filter(Boolean).length}`;
    }

    // --- ë™ì‘ ë¡œì§ ---
    let lastList = []; // ìµœê·¼ ë°°ì¹˜ì— ì‚¬ìš©í•œ ì´ë¦„ ëª©ë¡(ìˆœì„œ ë¬´ê´€ ì›ë³¸)

    async function fillRandomNames(){
      const cap = capacity();

      const { value: count } = await Swal.fire({
        title: "ëœë¤ ì´ë¦„ ì±„ìš°ê¸°",
        text: `ëª‡ ëª…ì„ ì±„ìš¸ê¹Œìš”? (ì¢Œì„ ìˆ˜: ${cap})`,
        input: "number",
        inputValue: Math.max(1, Math.min(cap || 20, 20)),
        inputAttributes: { min: 1, max: 1000, step: 1 },
        showCancelButton: true,
        confirmButtonText: "ì±„ìš°ê¸°",
        cancelButtonText: "ì·¨ì†Œ"
      });
      if(!count) return;

      const need = Math.max(1, parseInt(count,10));
      const pool = [...sampleNames];
      const result = [];

      // sampleNamesë¡œ ë¶€ì¡±í•˜ë©´ "í•™ìƒ 1, 2..." ìƒì„±
      for(let i=0;i<need;i++){
        if(i < pool.length){
          result.push(pool[i]);
        }else{
          result.push(`í•™ìƒ ${i+1}`);
        }
      }
      shuffle(result);
      namesEl.value = result.join("\n");
      saveState();
      Swal.fire("ì™„ë£Œ","ëœë¤ ì´ë¦„ì´ ì±„ì›Œì¡ŒìŠµë‹ˆë‹¤.","success");
    }

    function assign(){
      const rows = parseInt(rowsEl.value,10) || 0;
      const cols = parseInt(colsEl.value,10) || 0;
      if(rows < 1 || cols < 1){
        Swal.fire("ì˜¤ë¥˜","í–‰/ì—´ì€ 1 ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.","error");
        return;
      }

      let list = parseNames(namesEl.value);
      if(list.length === 0){
        Swal.fire("ì˜¤ë¥˜","í•™ìƒ ì´ë¦„ì„ í•œ ëª… ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.","error");
        return;
      }

      // ì´ë¦„ ì¤‘ë³µ ì œê±°(ê°™ì€ ì´ë¦„ì´ ì—¬ëŸ¬ ë²ˆ ë“¤ì–´ê°”ë‹¤ë©´ í•œ ë²ˆë§Œ ì‚¬ìš©)
      list = unique(list);
      lastList = [...list];

      const cap = rows * cols;
      if(list.length > cap){
        Swal.fire({
          icon: "warning",
          title: "ì¸ì›ìˆ˜ê°€ ì¢Œì„ë³´ë‹¤ ë§ì•„ìš”",
          html: `í•™ìƒ <b>${list.length}</b>ëª… vs ì¢Œì„ <b>${cap}</b>ì„<br>í–‰ê³¼ ì—´ì„ ëŠ˜ë¦¬ê±°ë‚˜, ì¸ì›ì„ ì¤„ì—¬ì£¼ì„¸ìš”.`,
          confirmButtonText: "í™•ì¸"
        });
        return;
      }

      const shuffled = shuffle([...list]);
      // ë¹ˆ ìë¦¬ ì±„ìš°ê¸°
      while(shuffled.length < cap) shuffled.push("");

      renderSeats(shuffled, rows, cols);
      saveState();
      Swal.fire("ë°°ì¹˜ ì™„ë£Œ", `ì´ ${list.length}ëª…ì„ ${rows}Ã—${cols} ì¢Œì„ì— ë°°ì¹˜í–ˆìŠµë‹ˆë‹¤.`, "success");
    }

    function reshuffle(){
      const rows = parseInt(rowsEl.value,10) || 0;
      const cols = parseInt(colsEl.value,10) || 0;
      const cap  = rows * cols;

      if(rows < 1 || cols < 1){
        Swal.fire("ì˜¤ë¥˜","í–‰/ì—´ì€ 1 ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.","error");
        return;
      }
      if(lastList.length === 0){
        assign();
        return;
      }
      if(lastList.length > cap){
        Swal.fire("ì˜¤ë¥˜","í˜„ì¬ ì¢Œì„ ìˆ˜ë³´ë‹¤ í•™ìƒì´ ë” ë§ìŠµë‹ˆë‹¤. í–‰/ì—´ì„ ëŠ˜ë ¤ì£¼ì„¸ìš”.","error");
        return;
      }

      const shuffled = shuffle([...lastList]);
      while(shuffled.length < cap) shuffled.push("");
      renderSeats(shuffled, rows, cols);
      Swal.fire("ì¬ë°°ì¹˜ ì™„ë£Œ", "ê°™ì€ ëª…ë‹¨ìœ¼ë¡œ ì¢Œì„ì„ ë‹¤ì‹œ ì„ì—ˆìŠµë‹ˆë‹¤.", "success");
    }

    function clearAll(){
      namesEl.value = "";
      rowsEl.value = 5;
      colsEl.value = 6;
      seatsEl.innerHTML = "";
      statsEl.textContent = "";
      lastList = [];
      localStorage.removeItem("seat_rows");
      localStorage.removeItem("seat_cols");
      localStorage.removeItem("seat_names");
    }

    // --- ì´ë²¤íŠ¸ ---
    btnFill.addEventListener("click", fillRandomNames);
    btnAssign.addEventListener("click", assign);
    btnReshuffle.addEventListener("click", reshuffle);
    btnClear.addEventListener("click", clearAll);

    namesEl.addEventListener("input", saveState);
    rowsEl.addEventListener("input", saveState);
    colsEl.addEventListener("input", saveState);

    // ë‹¨ì¶•í‚¤
    window.addEventListener("keydown", (e)=>{
      if(e.key === "Enter") assign();
      if(e.key.toLowerCase() === "r") reshuffle();
    });

    // ì´ˆê¸°í™”
    loadState();
    // ìµœì´ˆ ê·¸ë¦¬ë“œ í˜•íƒœë§Œ í‘œì‹œ
    renderSeats([], parseInt(rowsEl.value,10), parseInt(colsEl.value,10));
  </script>
</body>
</html>
