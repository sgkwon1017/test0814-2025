<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>학생 자리배치 프로그램</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    /* 약간의 디테일 */
    body{
      min-height:100vh;
      background: radial-gradient(1200px 800px at 80% -10%, #1f2937 0%, #0f172a 60%);
      color:#e5e7eb;
    }
    .glass {
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border: 1px solid rgba(255,255,255,.12);
      backdrop-filter: blur(8px);
    }
    .seat-card {
      transition: transform .08s ease, box-shadow .2s ease;
    }
    .seat-card:hover { transform: translateY(-2px); }
    .seat-empty { opacity:.6; }
    .badge-kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      border:1px solid rgba(255,255,255,.18);
      border-radius:6px;
      padding:2px 6px;
      font-size:12px;
    }
  </style>
</head>
<body class="d-flex align-items-center justify-content-center p-4">

  <main class="container">
    <div class="glass rounded-4 shadow-lg p-4 p-md-5 mx-auto" style="max-width: 1080px;">
      <div class="d-flex flex-wrap align-items-end justify-content-between gap-2 mb-3">
        <div>
          <h1 class="h3 fw-bold mb-1">학생 자리배치 프로그램</h1>
          <p class="text-secondary mb-0">이름을 입력하고, 행·열을 지정한 뒤 <b>랜덤 배치</b>하세요.</p>
        </div>
        <div class="text-secondary">
          단축키: <span class="badge-kbd">Enter</span>=배치, <span class="badge-kbd">R</span>=재배치
        </div>
      </div>

      <!-- 설정 -->
      <div class="row g-3">
        <div class="col-12 col-lg-6">
          <label for="names" class="form-label">학생 이름 목록 <small class="text-secondary">(줄바꿈으로 구분)</small></label>
          <textarea id="names" class="form-control" rows="8" placeholder="예)&#10;홍길동&#10;김철수&#10;이영희"></textarea>
          <div class="form-text">이름을 한 줄에 한 명씩 입력하세요.</div>
        </div>

        <div class="col-12 col-lg-6">
          <div class="row g-3">
            <div class="col-6">
              <label for="rows" class="form-label">행(Row)</label>
              <input id="rows" type="number" class="form-control" min="1" value="5">
            </div>
            <div class="col-6">
              <label for="cols" class="form-label">열(Col)</label>
              <input id="cols" type="number" class="form-control" min="1" value="6">
            </div>

            <div class="col-12 d-flex gap-2">
              <button id="btnFill" class="btn btn-secondary flex-fill">📝 랜덤 이름 채우기</button>
              <button id="btnAssign" class="btn btn-primary flex-fill">🎲 자리 배치</button>
            </div>

            <div class="col-12 d-flex gap-2">
              <button id="btnReshuffle" class="btn btn-outline-light flex-fill">🔁 같은 명단 재배치</button>
              <button id="btnClear" class="btn btn-outline-danger flex-fill">🧹 초기화</button>
            </div>

            <div class="col-12">
              <div id="stats" class="text-secondary small"></div>
            </div>
          </div>
        </div>
      </div>

      <hr class="border-secondary-subtle my-4">

      <!-- 좌석 배치 출력 -->
      <div id="seatWrap" class="w-100">
        <div id="seats" class="grid gap-3"></div>
      </div>
    </div>
  </main>

  <script>
    // --- 요소 참조 ---
    const $ = (id) => document.getElementById(id);
    const namesEl = $("names");
    const rowsEl  = $("rows");
    const colsEl  = $("cols");
    const seatsEl = $("seats");
    const statsEl = $("stats");
    const btnFill = $("btnFill");
    const btnAssign = $("btnAssign");
    const btnReshuffle = $("btnReshuffle");
    const btnClear = $("btnClear");

    // --- 샘플 이름 풀 (50+명) ---
    const sampleNames = [
      "김가은","김도윤","김민준","김서준","김서연","김서윤","김시우","김예린","김유준","김지우",
      "박건우","박도윤","박민서","박서율","박서연","박지후","박하린","박하윤","박현우","박혜인",
      "서다인","서민재","서소율","서우진","서채원","서하준","서현우","서희원","성지후","소지유",
      "안도현","안민규","안서진","안예진","양지윤","오가온","오다은","오서아","오예준","오지안",
      "유나윤","유도현","유리하","유서하","유지호","윤가온","윤도윤","윤서현","윤예진","윤지후",
      "이건희","이도현","이민재","이서윤","이승우","이시윤","이예나","이정우","이지후","이하린",
      "임나예","임다온","임라온","임서우","임지안","장민서","장서연","장수아","전도율","전우주",
      "정가은","정도윤","정민준","정서우","정시윤","정예준","정이든","정주하","조나율","조민하"
    ];

    // --- 유틸 ---
    function shuffle(arr){
      for(let i=arr.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [arr[i],arr[j]] = [arr[j],arr[i]];
      }
      return arr;
    }
    const unique = (arr) => [...new Set(arr)];

    function parseNames(text){
      return text
        .split(/\n+/)
        .map(s => s.trim())
        .filter(Boolean);
    }

    function capacity(){
      const r = parseInt(rowsEl.value,10) || 0;
      const c = parseInt(colsEl.value,10) || 0;
      return Math.max(0, r) * Math.max(0, c);
    }

    function saveState(){
      localStorage.setItem("seat_rows", rowsEl.value);
      localStorage.setItem("seat_cols", colsEl.value);
      localStorage.setItem("seat_names", namesEl.value);
    }

    function loadState(){
      const r = localStorage.getItem("seat_rows");
      const c = localStorage.getItem("seat_cols");
      const n = localStorage.getItem("seat_names");
      if(r) rowsEl.value = r;
      if(c) colsEl.value = c;
      if(n) namesEl.value = n;
    }

    // --- 좌석 렌더링 ---
    function renderSeats(list, rows, cols){
      // Tailwind CSS grid 템플릿 동적 지정
      seatsEl.style.display = "grid";
      seatsEl.style.gridTemplateColumns = `repeat(${cols}, minmax(0,1fr))`;

      seatsEl.innerHTML = "";
      const total = rows * cols;

      for(let i=0;i<total;i++){
        const name = list[i] ?? "";
        const card = document.createElement("div");
        card.className = `seat-card rounded-3 p-3 text-center shadow-sm glass ${name ? "" : "seat-empty"}`;

        const seatNo = document.createElement("div");
        seatNo.className = "small text-secondary mb-1";
        seatNo.textContent = `${i+1}번 자리`;

        const label = document.createElement("div");
        label.className = "fw-bold h5 mb-0";
        label.textContent = name || "빈 자리";

        card.appendChild(seatNo);
        card.appendChild(label);
        seatsEl.appendChild(card);
      }

      statsEl.textContent = `좌석 수: ${total} • 배치된 학생: ${list.filter(Boolean).length}`;
    }

    // --- 동작 로직 ---
    let lastList = []; // 최근 배치에 사용한 이름 목록(순서 무관 원본)

    async function fillRandomNames(){
      const cap = capacity();

      const { value: count } = await Swal.fire({
        title: "랜덤 이름 채우기",
        text: `몇 명을 채울까요? (좌석 수: ${cap})`,
        input: "number",
        inputValue: Math.max(1, Math.min(cap || 20, 20)),
        inputAttributes: { min: 1, max: 1000, step: 1 },
        showCancelButton: true,
        confirmButtonText: "채우기",
        cancelButtonText: "취소"
      });
      if(!count) return;

      const need = Math.max(1, parseInt(count,10));
      const pool = [...sampleNames];
      const result = [];

      // sampleNames로 부족하면 "학생 1, 2..." 생성
      for(let i=0;i<need;i++){
        if(i < pool.length){
          result.push(pool[i]);
        }else{
          result.push(`학생 ${i+1}`);
        }
      }
      shuffle(result);
      namesEl.value = result.join("\n");
      saveState();
      Swal.fire("완료","랜덤 이름이 채워졌습니다.","success");
    }

    function assign(){
      const rows = parseInt(rowsEl.value,10) || 0;
      const cols = parseInt(colsEl.value,10) || 0;
      if(rows < 1 || cols < 1){
        Swal.fire("오류","행/열은 1 이상이어야 합니다.","error");
        return;
      }

      let list = parseNames(namesEl.value);
      if(list.length === 0){
        Swal.fire("오류","학생 이름을 한 명 이상 입력해주세요.","error");
        return;
      }

      // 이름 중복 제거(같은 이름이 여러 번 들어갔다면 한 번만 사용)
      list = unique(list);
      lastList = [...list];

      const cap = rows * cols;
      if(list.length > cap){
        Swal.fire({
          icon: "warning",
          title: "인원수가 좌석보다 많아요",
          html: `학생 <b>${list.length}</b>명 vs 좌석 <b>${cap}</b>석<br>행과 열을 늘리거나, 인원을 줄여주세요.`,
          confirmButtonText: "확인"
        });
        return;
      }

      const shuffled = shuffle([...list]);
      // 빈 자리 채우기
      while(shuffled.length < cap) shuffled.push("");

      renderSeats(shuffled, rows, cols);
      saveState();
      Swal.fire("배치 완료", `총 ${list.length}명을 ${rows}×${cols} 좌석에 배치했습니다.`, "success");
    }

    function reshuffle(){
      const rows = parseInt(rowsEl.value,10) || 0;
      const cols = parseInt(colsEl.value,10) || 0;
      const cap  = rows * cols;

      if(rows < 1 || cols < 1){
        Swal.fire("오류","행/열은 1 이상이어야 합니다.","error");
        return;
      }
      if(lastList.length === 0){
        assign();
        return;
      }
      if(lastList.length > cap){
        Swal.fire("오류","현재 좌석 수보다 학생이 더 많습니다. 행/열을 늘려주세요.","error");
        return;
      }

      const shuffled = shuffle([...lastList]);
      while(shuffled.length < cap) shuffled.push("");
      renderSeats(shuffled, rows, cols);
      Swal.fire("재배치 완료", "같은 명단으로 좌석을 다시 섞었습니다.", "success");
    }

    function clearAll(){
      namesEl.value = "";
      rowsEl.value = 5;
      colsEl.value = 6;
      seatsEl.innerHTML = "";
      statsEl.textContent = "";
      lastList = [];
      localStorage.removeItem("seat_rows");
      localStorage.removeItem("seat_cols");
      localStorage.removeItem("seat_names");
    }

    // --- 이벤트 ---
    btnFill.addEventListener("click", fillRandomNames);
    btnAssign.addEventListener("click", assign);
    btnReshuffle.addEventListener("click", reshuffle);
    btnClear.addEventListener("click", clearAll);

    namesEl.addEventListener("input", saveState);
    rowsEl.addEventListener("input", saveState);
    colsEl.addEventListener("input", saveState);

    // 단축키
    window.addEventListener("keydown", (e)=>{
      if(e.key === "Enter") assign();
      if(e.key.toLowerCase() === "r") reshuffle();
    });

    // 초기화
    loadState();
    // 최초 그리드 형태만 표시
    renderSeats([], parseInt(rowsEl.value,10), parseInt(colsEl.value,10));
  </script>
</body>
</html>
